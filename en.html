<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./pngaaa.com-5103885.ico" type="image/icon type" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <title>Planer</title>
  </head>
  <body>
    <div>
      <span class="lang" id="#" onclick="goToAr()">عربي</span
      ><span onclick="goToEn()" class="lang" id="#">English</span>
    </div>
    <div id="pdf">
      <h1 id="title">Welcome in personal training App</h1>
      <h2></h2>
      <div class="flex">
        <div id="diet" class="diet"></div>
        <div id="results" class="results"></div>
      </div>

      <form class="flex-input" id="planerId" action="" onsubmit="return false">
        <div class="input-line">
          <label for="fname"> Name :</label>
          <input class="input" type="text" id="fname" name="fname" value="" />
        </div>

        <div class="input-line">
          <label for="age">Age :</label>
          <input class="input" type="number" id="age" name="age" value="" /><br />
        </div>

        <div class="input-line">
          <label for="sex">sex :</label>
          <select class="input" name="" id="sex">
            <option value=""></option>
            <option value="male">male</option>
            <option value="female">female</option>
          </select>
        </div>

        <div class="input-line">
          <label for="height"> Height</label>
          <input class="input" type="number" id="height" name="height" value="" />
          <span>cm</span>
        </div>

        <div class="input-line">
          <label for="weight"> Weight :</label>
          <input class="input" type="number" id="weight" name="weight" value="" />
          <span>kg</span>
        </div>

        <div class="input-line">
          <label for="goal"> Your goal :</label>
          <select class="input" name="" id="goal">
            <option value=""></option>
            <option value="losing">Losing weight</option>
            <option value="gain">Gaining weight</option>
            <option value="gain-musels">gain musels mass</option>
            <option value="keep">General healthy life style</option>
          </select>
        </div>

        <div class="input-line">
          <label for="motobolic"> Your metabolism :</label>
          <select class="input" name="" id="motobolic">
            <option value=""></option>
            <option value="fast">Fast</option>
            <option value="slow">Slow</option>
            <option value="medium">medium</option>
          </select>
        </div>

        <div class="input-line">
          <label for="experance"> Your experience in sport : </label>
          <select class="input" name="" id="experance">
            <option value=""></option>
            <option value="6m">Less than 6 months</option>
            <option value="1y">From 6 months to 1 year</option>
            <option value="more1y">More than one year</option>
          </select>
        </div>

        <div class="input-line">
          <label for="meals"> How many meals do you like to eat ?</label>
          <!-- <input class="input" type="number" id="meals" name="meals" value="" /> -->
          <select class="input" name="" id="meals">
            <option value=""></option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        <div class="input-line">
          <label for="days">How many day do you like to train ?</label>
          <select class="input" name="" id="days">
            <option value=""></option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
        </div>

        <div class="input-line">
          <label for="time"> Training time : </label>
          <select class="input" name="" id="time">
            <option value=""></option>
            <option value="30">30 minutes</option>
            <option value="45">45 minutes</option>
            <option value="60">60 minutes</option>
            <option value="75">75 minutes</option>
            <option value="90">90 minutes</option>
            <option value="105">105 minutes</option>
            <option value="120">120 minutes</option>
          </select>
        </div>

        <div class="input-line">
          <label for="anabolic">Using anabolic :</label>
          <select class="input" name="" id="anabolic">
            <option value=""></option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <br />
        <div class="input-line">
          <input class="btn" type="submit" onclick="renderResult()" value="submit" />
        </div>
      </form>
      <br />
    </div>
    <div class="input-line">
      <input id="generatePDF" class="btn downlaod" type="submit" value="download as pdf" />
    </div>
    <footer>
      <hr />
      <p>2021 Copyright. All Rights Reserved</p>
    </footer>
  </body>
  <script src="./programs.js"></script>
  <script src="./actions.js"></script>
  <script>
    document.body.style.direction = 'ltr';
    const pageURL = window.location.href;

    const goToAr = () => {
      if (pageURL.substr(-7, 7) == 'en.html') {
        let arPage = pageURL.replace('en.html', '');
        window.location.href = arPage;
      }
    };
    const goToEn = () => {
      if (pageURL.substr(-7, 7) != 'en.html') {
        let enPage = pageURL + 'en.html';
        window.location.href = enPage;
      }
    };

    $('#generatePDF').click(function () {
      const input = document.getElementById('pdf');
      const eleHeight = input.offsetHeight;
      const screenWidth = input.offsetWidth;
      console.log(eleHeight, screenWidth);
      html2canvas(input, {
        allowTaint: true,
        backgroundColor: '#181818',
        // scale: 0.8,
        width: screenWidth,
        height: eleHeight,
        scrollY: document.body.scrollHeight,
      }).then((canvas) => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'pt', [screenWidth, eleHeight]);
        pdf.addImage(imgData, 'PNG', 0, 0, screenWidth, eleHeight);
        pdf.save('training-plan.pdf');
      });
    });

    const user = {};
    const renderResult = () => {
      const form = document.getElementById('planerId');
      user.firstName = form.elements['fname'];
      // user.lastName = form.elements['lname'];
      user.age = form.elements['age'];
      user.sex = form.elements['sex'];
      user.height = form.elements['height'];
      user.weight = form.elements['weight'];
      user.goal = form.elements['goal'];
      user.motobolic = form.elements['motobolic'];
      user.experance = form.elements['experance'];
      user.meals = form.elements['meals'];
      user.time = form.elements['time'];
      user.days = form.elements['days'];
      user.anabolic = form.elements['anabolic'];
      for (const [key, value] of Object.entries(user)) {
        let ele = document.getElementsByClassName('requier-' + key);
        if (ele.length > 0) {
          for (let span of ele) {
            span.remove();
          }
        }
        if (!value.value) {
          if (ele.length == 0) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" > This field require</span>`,
            );
          }
        }
        // Age validation
        if (key == 'age') {
          if (Number.isInteger(value.value)) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Age must be an integer</span>`,
            );
          }
          if ((value.value < 12 && value.value > 4) || (value.value > 120 && value.value < 151)) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Age must be between 12 and 120</span>`,
            );
          }
          if ((value.value < 5 || value.value > 150) && value.value) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" > Are you kidding me...</span>`,
            );
          }
        }
        // Height validation
        if (key == 'height') {
          if (Number.isInteger(value.value)) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Height must be an integer</span>`,
            );
          }
          if (
            (value.value < 100 && value.value >= 50) ||
            (value.value > 220 && value.value <= 250)
          ) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >  Height must be between 100 and 220 </span>`,
            );
          }
          if ((value.value < 50 || value.value > 250) && value.value) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" > Are you kidding me...</span>`,
            );
          }
        }
        // Weight validation
        if (key == 'weight') {
          if (Number.isInteger(value.value)) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Weight must be an integer</span>`,
            );
          }
          if (
            (value.value < 30 && value.value >= 28) ||
            (value.value > 350 && value.value <= 360)
          ) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Weight must be between 30 and 350 </span>`,
            );
          }
          if ((value.value < 28 || value.value > 360) && value.value) {
            value.insertAdjacentHTML(
              'afterend',
              `<span class="requier-${key}" >Are you kidding me...</span>`,
            );
          }
        }
      }
      // remove the fill in msg
      let fillInMsg = document.getElementById('fill_in');
      if (fillInMsg) {
        fillInMsg.remove();
      }
      let ele = document.querySelectorAll('[class^="requier-"]');

      if (ele.length > 0) {
        form.insertAdjacentHTML(
          'afterend',
          `<span id="fill_in" class="requier-" >  Please fill in the require field</span>`,
        );
      } else {
        // do what you want after all checking.......
        console.log(calcMeals(user));
        const diet = calcMeals(user);
        const food = document.getElementById('diet');
        document.getElementById(
          'title',
        ).innerHTML = `Training program for  ${user.firstName.value}`;
        food.innerHTML += `<h3 >  Diet :</h3>
                              <ul class="total">
                                <li>     Total calories in day :  ${
                                  diet.food.total_calories
                                } cal</li>
                                <li>    Total carbs in day :  ${diet.food.carb.toFixed(2)} gram</li>
                                <li>  Total fat in day :  ${diet.food.fat.toFixed(2)} gram</li>
                                <li>    Total protein in day :  ${diet.food.protin.toFixed(
                                  2,
                                )} gram</li>
                              </ul> `;

        food.innerHTML += `<h3>  Meals :</h3>`;
        const mealNum = [' Meal 1 ', ' Meal 2 ', '  Meal 3 ', ' Meal 4  ', ' Meal 5  '];
        Object.keys(diet.meals).forEach((meal, index) => {
          food.innerHTML += `
                              <ul>
                                <li>${mealNum[index]} :
                                  <span>  Protein : ${diet.meals[meal].protin}g,</span>
                                  <span>Carps : ${diet.meals[meal].carb}g ,</span>
                                  <span>Fat : ${diet.meals[meal].fat}g </span>
                                </li>
                              </ul> `;
        });

        const exercises = ['back', 'chest', 'legs', 'shoulder', 'biceps', 'triceps'];
        const days = [' (day 1)', ' (day 2)', ' (day 3)', ' (day 4)', ' (day 5)', '(day 6)'];
        const results = program(user, programs);

        // console.log(results);
        const form = document.getElementById('planerId');
        const result = document.getElementById('results');
        form.style.display = 'none';

        results.forEach((item, index) => {
          let day = days[index];
          let indexes = [];
          let itemsLength = Object.keys(item).length;
          Object.keys(item).forEach((i) => {
            if (exercises.includes(i)) {
              if (!indexes.includes(index)) {
                indexes.push(index);
              } else {
                day = '';
              }
              result.innerHTML += `<div style="direction:ltr">
                                         <h3>${i + '   ' + day}</h3>
                                         <ol id="${i + index + item[i][item[i].length - 1]}"></ol>
                                       </div>`;
            }
            if (exercises.includes(i)) {
              item[i].forEach((exercise, num) => {
                const list = document.getElementById(i + index + item[i][item[i].length - 1]);
                list.innerHTML += `<li>${exercise + ' ' + item.sets}</li>`;
                if (results[0]['cardio'] && num == item[i].length - 1) {
                  if (
                    itemsLength == 2 ||
                    (itemsLength >= 3 && day == '') ||
                    (itemsLength == 3 && Object.keys(results[0]).length == 3)
                  ) {
                    list.innerHTML += `<li>${
                      results[0]['cardio'][0] + ' ' + 'minutes cardio'
                    }</li>`;
                  }
                }
              });
            }
          });
          if (index == results.length - 1 && results[results.length - 1]['cardio']) {
            result.innerHTML += `<div style="direction:ltr">
                                           <h3>cardio ${days[5]}</h3>
                                           <div class="cardio">${
                                             results[results.length - 1]['cardio'][0]
                                           } minutes cardio</din>
                                         </div>`;
          }
        });
        document.getElementById('generatePDF').style.display = 'block';
        // console.log(user);
      }
    };
  </script>
</html>
